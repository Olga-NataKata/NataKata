{{ 'preloader.css' | asset_url | stylesheet_tag }}

<div class="preloader color-{{ settings.theme_preloader_color_scheme }}">
		<div class="preloader-holder">
				<div class="preloader-logo active">
						<div class="preloader-logo-image">
								{% if settings.preloader_logo != blank %}
										<h2 class="logo-title">{{ settings.preloader_logo }}</h2>
								{% elsif settings.preloader_logo_image != blank %}
										<h2>
												<img srcset="{{ settings.preloader_logo_image | image_url: width: 300 }} 300w" src="{{ settings.preloader_logo_image | image_url: width: 300 }}" loading="lazy" class="header__heading-logo" width="300" height="{{ settings.preloader_logo_image.height }}" alt="{{ settings.preloader_logo_image.alt | default: shop.name | escape }}">
										</h2>
								{% else %}
										<h2 class="logo-title">{{ shop.name }}</h2>
								{% endif %}
						</div>
						<div class="logo-loader">100%</div>
				</div>

				{% assign countIcon = 0 %}
				<div class="preloader-images">
						{% if settings.preloader_image1 != blank or settings.preloader_image2 != blank or 
								settings.preloader_image3 != blank or settings.preloader_image4 != blank or 
								settings.preloader_image5 != blank or settings.preloader_image6 != blank or 
								settings.preloader_image7 != blank or settings.preloader_image8 != blank %}

						{% if settings.preloader_image1 != blank %}
								<span class="preloader-images-item">
										<img srcset="{{ settings.preloader_image1 | image_url: width: 300 }} 300w"
												src="{{ settings.preloader_image1 | image_url: width: 300 }}"
												loading="lazy" class="header__heading-logo"
												width="300" height="{{ settings.preloader_image1.height }}" alt="{{ settings.preloader_image1.alt | default: shop.name | escape }}">
								</span>
						{% endif %}
						{% if settings.preloader_image2 != blank %}
								<span class="preloader-images-item">
										<img srcset="{{ settings.preloader_image2 | image_url: width: 250 }} 250w"
												src="{{ settings.preloader_image2 | image_url: width: 300 }}"
												loading="lazy" class="header__heading-logo"
												width="250" height="{{ settings.preloader_image2.height }}" alt="{{ settings.preloader_image2.alt | default: shop.name | escape }}">
								</span>
						{% endif %}
						{% if settings.preloader_image3 != blank %}
								<span class="preloader-images-item">
										<img srcset="{{ settings.preloader_image3 | image_url: width: 200 }} 200w"
												src="{{ settings.preloader_image3 | image_url: width: 200 }}"
												loading="lazy" class="header__heading-logo"
												width="200" height="{{ settings.preloader_image3.height }}" alt="{{ settings.preloader_image3.alt | default: shop.name | escape }}">
								</span>
						{% endif %}
						{% if settings.preloader_image4 != blank %}
								<span class="preloader-images-item">
										<img srcset="{{ settings.preloader_image4 | image_url: width: 200 }} 200w"
												src="{{ settings.preloader_image4 | image_url: width: 200 }}"
												loading="lazy" class="header__heading-logo"
												width="200" height="{{ settings.preloader_image4.height }}" alt="{{ settings.preloader_image4.alt | default: shop.name | escape }}">
								</span>
						{% endif %}
						{% if settings.preloader_image5 != blank %}
								<span class="preloader-images-item">
										<img srcset="{{ settings.preloader_image5 | image_url: width: 300 }} 300w"
												src="{{ settings.preloader_image5 | image_url: width: 300 }}"
												loading="lazy" class="header__heading-logo"
												width="300" height="{{ settings.preloader_image5.height }}" alt="{{ settings.preloader_image5.alt | default: shop.name | escape }}">
								</span>
						{% endif %}
						{% if settings.preloader_image6 != blank %}
								<span class="preloader-images-item">
										<img srcset="{{ settings.preloader_image6 | image_url: width: 225 }} 225"
												src="{{ settings.preloader_image6 | image_url: width: 225 }}"
												loading="lazy" class="header__heading-logo"
												width="225" height="{{ settings.preloader_image6.height }}" alt="{{ settings.preloader_image6.alt | default: shop.name | escape }}">
								</span>
						{% endif %}
						{% if settings.preloader_image7 != blank %}
								<span class="preloader-images-item">
										<img srcset="{{ settings.preloader_image7 | image_url: width: 300 }} 300w"
												src="{{ settings.preloader_image7 | image_url: width: 300 }}"
												loading="lazy" class="header__heading-logo"
												width="300" height="{{ settings.preloader_image7.height }}" alt="{{ settings.preloader_image7.alt | default: shop.name | escape }}">
								</span>
						{% endif %}
						{% if settings.preloader_image8 != blank %}
								<span class="preloader-images-item">
										<img srcset="{{ settings.preloader_image8 | image_url: width: 350 }} 350"
												src="{{ settings.preloader_image8 | image_url: width: 350 }}"
												loading="lazy" class="header__heading-logo"
												width="350" height="{{ settings.preloader_image8.height }}" alt="{{ settings.preloader_image8.alt | default: shop.name | escape }}">
								</span>
						{% endif %}
				{% else %}
						{%- for i in (1..8) -%}
								{% if i < 7 %}
										{% assign countIcon = countIcon | plus: 1 %}
								{% else %}
										{% assign countIcon = countIcon | minus: 2 %}
								{% endif %}
								<span class="preloader-images-item images-placeholder">
										{{ 'product-' | append: countIcon | placeholder_svg_tag }}
								</span>
						{%- endfor -%}
				{% endif %}
				</div>
		</div>
</div>

<script>
		"use strict";
		let preloaderHomepageReloades = parseInt(sessionStorage.getItem('preloaderCounter') || 0);

		{% if settings.show_images == 'hide_images' %}
				const showImages = false;
		{% elsif settings.show_images == 'first_load' %}
				const showImages = 'first_load';
		{% elsif settings.show_images == 'all_load' %}
				const showImages = 'all_load';
		{% endif %}

		if ( showImages != false && preloaderHomepageReloades === 0 ) {

				window.onbeforeunload = function() {
						sessionStorage.removeItem('preloaderCounter');
						{% if settings.show_images == 'first_load' %}
								window.onunload = function () {
										sessionStorage.setItem('preloaderCounter', ++preloaderHomepageReloades);
								}
						{% elsif settings.show_images == 'all_load' %}
								window.onunload = function () {
										sessionStorage.setItem('preloaderCounter', 0);
								}
						{% endif %}
				};

				const loader = document.querySelector('.preloader');
				const loaderLogo = document.querySelector('.preloader-logo');
				const loaderLogoPercent = document.querySelector('.preloader-logo');
				const loaderImages = document.querySelector('.preloader-images');
				const startTime = new Date().getTime();

				loader.classList.add('active');

				function loaderStart(_success) {
						const inner = document.querySelector('.logo-loader');

						let w = 0,
								t = setInterval(function() {
										w = w + 2;
										inner.textContent = w+'%';
										if (w === 100) {
												clearInterval(t);
												w = 0;
										}
								}, 17);
				}

				loaderStart();

				function loaderEnd() {
						let endTime = new Date().getTime();
						const loadTime = endTime - startTime;

						function showPreloadImages() {
								loaderLogo.classList.remove('active');
								loaderImages.classList.add('active');
								setTimeout(() => {
										loader.classList.add('hide-loader');
								}, 3000);
						}

						window.addEventListener("load", event => {
								if (loadTime > 1400) {
										showPreloadImages();
								} else {
										setTimeout(() => {
												showPreloadImages();
										}, 1400 - loadTime);
								}
						});
				}

				document.addEventListener('DOMContentLoaded', loaderEnd);
				document.addEventListener('shopify:section:load', loaderEnd);

		} else {

				window.onbeforeunload = function() {
						sessionStorage.removeItem('preloaderCounter');
						{% if settings.show_images == 'first_load' %}
								window.onunload = function () {
										sessionStorage.setItem('preloaderCounter', ++preloaderHomepageReloades);
								}
						{% elsif settings.show_images == 'all_load' %}
								window.onunload = function () {
										sessionStorage.setItem('preloaderCounter', 0);
								}
						{% endif %}
				};

				const loader = document.querySelector('.preloader');
				loader.classList.add('active');
				function loaderStart(_success) {
						const inner = document.querySelector('.logo-loader');
						let w = 0,
								t = setInterval(function() {
										w = w + 2;
										inner.textContent = w+'%';
										if (w === 100) {
												clearInterval(t);
												w = 0;
												loader.classList.add('hide-loader');
										}
								}, 5);

						function loaderEnd() {
								setTimeout(() => {
										loader.classList.add('hide-loader');
								}, 300);
						}
						document.addEventListener('DOMContentLoaded', loaderEnd);
						document.addEventListener('shopify:section:load', loaderEnd);
				}

				loaderStart();
		}
</script>