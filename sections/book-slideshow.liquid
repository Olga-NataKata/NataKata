{{ 'Book-slideshow.css' | asset_url | stylesheet_tag }}

{%- style -%}
  #shopify-section-{{ section.id }}  {
		{%- assign background_image = section.settings.background | image_url: width: 2000 -%}
		{%- assign background_image_url = 'url(' | append: background_image | append: ')' -%}
		--background-img: {{ background_image_url }};
	}

  #shopify-section-{{ section.id }} .hard {
		{%- assign background_image = section.settings.front_image_bg | image_url: width: 2000 -%}
		{%- assign background_image_url = 'url(' | append: background_image | append: ')' -%}
		--background-img: {{ background_image_url }};
	}
{%- endstyle -%}

<book-slideshow class="book-flipbook-body color-{{ section.settings.scheme }}" data-section-id="{{ section.id }}" data-front-page-img="{{ section.settings.front_image_bg | image_url: 2000 }}">
  <div class="book-flipbook__overlay"></div>
  <div class="flipbook">
    <div
      class="hard"
			id="front-page-{{ section.id }}"
      style="
        background-image: url(var(--background-img));
        background-size: cover;
        background-position: center;
      "
    >
			{%- if section.settings.front_image != blank -%}
				<img class="logo" src="{{ section.settings.front_image | image_url: width: 500 }}" width="500" height="auto"alt="{{ section.settings.front_image.alt }}">
			{%- endif -%}
			{%- if section.settings.front_heading != blank -%}
				{{ section.settings.front_heading | escape }}
			{%- endif -%}
			{%- if section.settings.front_text != blank -%}
				<small>{{ section.settings.front_text }}</small>
			{%- endif -%}
    </div>
		
		{%- for block in section.blocks -%}

			<div  class="page">
			{%- if block.settings.video != blank -%}
					{{
            block.settings.video
            | video_tag:
              autoplay: true,
              loop: true,
              controls: false,
              muted: true,
							class: 'BookVideo'
          }} 
			{%- else -%}

				{% assign product = block.settings.product %}
				{%- if product.featured_image != blank -%}
					<img class="logo" src="{{ product.featured_image | image_url: width: 1920 }}" width="1920" height="auto"alt="{{ product.featured_image.alt }}">
					{%- if block.settings.heading != blank -%}
						<p>{{ block.settings.heading | escape }}</p>
					{%- endif -%}
					{%- if block.settings.product != blank -%}
						<a href="{{ product.url }}" class="dot-link">
							<div class="description-box">
								{%- if product.title != blank -%}
									<strong class="title">{{ product.title }}</strong>
								{%- endif -%}
								{%- if product.description != blank -%}
									<span class="subtitle">{{ product.description | strip_html | truncate: 100 }}</span>
								{%- endif -%}
							</div>
						</a>
					{%- endif -%}
				{%- endif -%}
			{%- endif -%}	
			</div>
		{%- endfor -%}
  </div>
</book-slideshow>

<script src="{{ 'book-slideshow.js' | asset_url }}" type="module" defer="defer"></script>

{% schema %}
{
  "name": "Book slideshow",
  "class": "section",
  "disabled_on": {
    "groups": ["header", "footer"]
  },
  "settings": [
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "t:sections.all.colors.label",
      "default": "scheme-1"
    },
		{
			"type": "image_picker",
			"id": "background",
			"label": "Background image"
		},
    {
      "type": "header",
      "content": "Front book page"
    },
    {
      "type": "image_picker",
      "id": "front_image_bg",
      "label": "Background image"
    },
		{ "type": "image_picker",
      "id": "front_image",
      "label": "Image"
    },
		{
			"type": "text",
			"id": "front_heading",
			"label": "Heading",
			"default": "Look book!"
		},
		{
			"type": "text",
			"id": "front_text",
			"label": "Text",
			"default": "~ NataKuku"
		}
  ],
	"blocks": [
		{
			"type": "slide",
			"name": "Slide",
			"settings": [
				{
					"type": "image_picker",
					"id": "image",
					"label": "Image"
				},
				{
					"type": "video",
					"id": "video",
					"label": "Video",
					"info": "Video replaces image"
				},
				{
					"type": "product",
					"id": "product",
					"label": "Product"
				},
				{
					"type": "text",
					"id": "heading",
					"label": "Heading",
					"default": "Heading"
				}
			]
		},
	],
  "presets": [
    {
      "name": "book slideshow",
			"blocks": [
        {
          "type": "slide"
        },
        {
          "type": "slide"
        },
        {
          "type": "slide"
        }
      ]
    }
  ]
}
{% endschema %}
